# 复制为 config.toml 使用
orchestrator_url = "ws://backend:3000/ws/agent"
auth_token = ""
register_url = "http://backend:3000/api/admin/acp-proxy/register"
bootstrap_token = ""

heartbeat_seconds = 30
mock_mode = false

# 在 sandbox 内启动 ACP agent 的命令（不会经过 shell；必须是 argv 数组）
# 镜像里已全局安装 codex-acp（/usr/local/bin/codex-acp），直接运行即可。
agent_command = ["codex-acp"]

[sandbox]
# 统一沙箱配置：provider + image + 运行参数
terminalEnabled = true

# ACP agent 启动模式（内部固定）：
# - container_oci: 强制使用 "entrypoint" 模式（容器主进程为 agent）
# - boxlite_oci: 使用 "exec" 模式


# provider: "container_oci" | "boxlite_oci" | "host_process" | "bwrap"
provider = "bwrap"

# host_process（PoC，低隔离）：在宿主机直接启动 ACP agent。
# ⚠️ 风险提示：几乎没有隔离，只建议本地开发/排障；必须关闭 terminalEnabled，
# 且仅支持 workspaceProvider=host（只允许 git 与内置 fs 操作）。

# 仅 provider=container_oci 时需要：docker/podman/nerdctl
runtime = "docker"

# 运行 ACP agent 的 OCI 镜像名（container_oci, boxlite_oci 需要）
# 本仓库提供 acp-proxy/agent-images/codex-acp/Dockerfile 可构建 tuixiu-codex-acp:local
image = "yoke233/tuixiu-acp-proxy:latest"

# 容器/BoxLite 内的工作目录（Run 的 workspace 固定在 guest 内 /workspace；通常由 `acp_open.init.script` 负责 git clone）
workingDir = "/workspace"

# workspaceProvider: "host" | "guest"
workspaceProvider = "host"
# workspaceMode: "mount" | "git_clone"
workspaceMode = "mount"


# 宿主机 workspace 根目录（仅 mount 模式需要）
workspaceHostRoot = "/workspaces"

# BoxLite 模式（simple=默认，jsbox=可复用 box）
# boxMode = "jsbox"
# boxName + boxReuse=shared 可复用缓存（不再重复创建/安装）
# boxName = "codex-box"
# boxReuse = "shared"
# boxAutoRemove = false
# execTimeoutSeconds = 300
# execLogIntervalSeconds = 10

# 运行时安装（示例：本地安装 codex + codex-acp）
# [sandbox.bootstrap]
# checkCommand = ["bash", "-lc", "which @zed-industries/codex-acp >/dev/null 2>&1"]
# installCommand = ["bash", "-lc", "npm i -g @openai/codex @zed-industries/codex-acp"]
# timeoutSeconds = 900

# 仅 provider=container_oci 时使用：透传给 `<runtime> run` 的额外参数
# extraRunArgs = ["--network=host"]

[sandbox.env]
# 不在这里注入 OPENAI_API_KEY：优先使用挂载进来的 `/root/.codex/config.toml`（避免把占位符覆盖掉真实配置）。

# Codex（`codex` / `codex-acp`）通常需要读取宿主机的 `~/.codex/config.toml`。
# 这里建议把该文件以只读方式挂载到容器内 `/root/.codex/config.toml`（镜像默认以 root 运行）。
#
# 注意：`docker` 不会自动展开 `~`，请写绝对路径。
# Windows 示例：C:/Users/<you>/.codex/config.toml
# macOS/Linux 示例：/Users/<you>/.codex/config.toml 或 /home/<you>/.codex/config.toml
#
#[[sandbox.volumes]]
#hostPath = "/root/.codex"
#guestPath = "/root/.codex"

[agent]
# 上报到 orchestrator 的 agent 识别信息（建议全局唯一 id）
id = "codex-agent-1"
name = "codex-agent-1"
max_concurrent = 5

[agent.capabilities]
languages = ["typescript"]
