# 用 UUIDv7 生成“可按时间排序”的业务 ID

**提取时间：** 2026-01-26  
**适用上下文：** 业务需要大量 UUID，但希望“天然可排序/自带时间”以便列表/事件流更稳定（比 UUIDv4 更适合按时间展示）

## 问题

- 现象：UUIDv4 无序，按 `id` 排序无法反映创建时间；跨端/离线/多源合并时排序不稳定。
- 根因：UUIDv4 是完全随机；如果不额外带时间戳字段或不按 `createdAt` 排序，就无法从 `id` 推导时间顺序。

## 解决方案

- 使用 UUIDv7：把毫秒级时间戳编码进高位，并在同毫秒内用单调序列避免碰撞/乱序。
- 在 Node 侧实现轻量生成器：
  - 48-bit Unix ms 时间戳（大端）
  - 12-bit 同毫秒单调序列（带随机起点）
  - 版本位设为 7、variant 设为 RFC4122

## 示例

- 参考实现：`backend/src/utils/uuid.ts`
- 用途：为 artifact/event 等记录生成更好排序的 `id`

## 何时使用

- 你希望“ID 自带时间可排序”，并且不想额外依赖数据库自增或复杂排序键。
- 你有事件流/日志流，常需要“按 id 近似时间排序”作为兜底。

> 注意：单调序列仅对单进程有效；多进程并发仍建议保留 `createdAt` 做最终排序。

